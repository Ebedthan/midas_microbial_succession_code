P.amf.disp.decline <- mean(
(post.bayes.disp$b_age_s + post.bayes.disp$`b_age_s:guildAMF`) < 0
)
P.amf.disp.decline
### cross-guild comparison
P.amf.more.convergence <- mean(
post.bayes.disp$`b_age_s:guildAMF` < 0
)
P.amf.more.convergence
### bacterial convergence
P.bact.disp.decline <- mean(post.bayes.disp$b_age_s < 0)
P.bact.disp.decline
### probability of declining turnover with age
P.amf.turnover.decline <- mean(
post.bayes.turnover$`bs_sage_s:guildAMF_1` < 0
)
P.amf.turnover.decline
P.bact.turnover.decline <- mean(
post.bayes.turnover$`bs_sage_s:guildBacteria_1` < 0
)
P.bact.turnover.decline
### cross-guild comparison
P.amf.slower.turnover <- mean(
post.bayes.turnover$`bs_sage_s:guildAMF_1` >
post.bayes.turnover$`bs_sage_s:guildBacteria_1`
)
P.amf.slower.turnover
### bacterial convergence
P.bact.disp.decline <- mean(post.bayes.disp$b_age_s < 0)
P.bact.disp.decline
### AMF convergence
P.amf.disp.decline <- mean(
(post.bayes.disp$b_age_s + post.bayes.disp$`b_age_s:guildAMF`) < 0
)
P.amf.disp.decline
### cross-guild comparison
P.amf.more.convergence <- mean(
post.bayes.disp$`b_age_s:guildAMF` < 0
)
P.amf.more.convergence
### Plot Beta dispersion vs time
newdisp <- disp.long |>
dplyr::distinct(guild) |>
tidyr::expand_grid(
age_s = seq(
min(disp.long$age_s, na.rm = TRUE),
max(disp.long$age_s, na.rm = TRUE),
length.out = 200
),
site = NA
)
pred.disp <- bayes.disp |>
tidybayes::add_epred_draws(
newdata = newdisp,
re_formula = NA
)
P.bact.disp.decline
P.amf.disp.decline
annot.disp <- data.frame(
guild = c("AMF", "Bacteria"),
label = c(
"P(convergence) = 0.47",
"P(convergence) = 0.36"
),
x = 0.7,
y = c(0.7, 0.65)
)
ggplot() +
geom_point(
data = disp.long,
aes(x = age_s, y = dispersion, colour = guild),
alpha = 0.5,
size = 2
) + geom_text(
data = annot.disp,
aes(x = x, y = y, label = label, colour = guild),
hjust = 0,
size = 4
) +
tidybayes::stat_lineribbon(
data = pred.disp,
aes(x = age_s, y = .epred, fill = guild),
.width = 0.95,
alpha = 0.25
) +
stat_summary(
data = pred.disp,
aes(x = age_s, y = .epred, colour = guild),
fun = mean,
geom = "line",
linewidth = 1.2
) +
scale_colour_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00")
) +
scale_fill_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00")
) +
labs(
x = "Normalized time since abandonment",
y = "Beta-dispersion (distance to centroid)",
colour = "Guild",
fill = "Guild"
) +
theme_Publication()
annot.disp <- data.frame(
guild = c("AMF", "Bacteria"),
label = c(
"P(convergence) = 0.47",
"P(convergence) = 0.36"
),
x = 0.8,
y = c(0.75, 0.7)
)
p7 <- ggplot() +
geom_point(
data = disp.long,
aes(x = age_s, y = dispersion, colour = guild),
alpha = 0.5,
size = 2
) + geom_text(
data = annot.disp,
aes(x = x, y = y, label = label, colour = guild),
hjust = 0,
size = 4
) +
tidybayes::stat_lineribbon(
data = pred.disp,
aes(x = age_s, y = .epred, fill = guild),
.width = 0.95,
alpha = 0.25
) +
stat_summary(
data = pred.disp,
aes(x = age_s, y = .epred, colour = guild),
fun = mean,
geom = "line",
linewidth = 1.2
) +
scale_colour_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00")
) +
scale_fill_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00")
) +
labs(
x = "Normalized time since abandonment",
y = "Beta-dispersion (distance to centroid)",
colour = "Guild",
fill = "Guild"
) +
theme_Publication()
export_plot(p7, "Fig4.png", type = "png", width = 13, height = 8)
annot.disp <- data.frame(
guild = c("AMF", "Bacteria"),
label = c(
"P(convergence) = 0.48",
"P(convergence) = 0.37"
),
x = 0.8,
y = c(0.75, 0.7)
)
p7 <- ggplot() +
geom_point(
data = disp.long,
aes(x = age_s, y = dispersion, colour = guild),
alpha = 0.5,
size = 2
) + geom_text(
data = annot.disp,
aes(x = x, y = y, label = label, colour = guild),
hjust = 0,
size = 4
) +
tidybayes::stat_lineribbon(
data = pred.disp,
aes(x = age_s, y = .epred, fill = guild),
.width = 0.95,
alpha = 0.25
) +
stat_summary(
data = pred.disp,
aes(x = age_s, y = .epred, colour = guild),
fun = mean,
geom = "line",
linewidth = 1.2
) +
scale_colour_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00")
) +
scale_fill_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00")
) +
labs(
x = "Normalized time since abandonment",
y = "Beta-dispersion (distance to centroid)",
colour = "Guild",
fill = "Guild"
) +
theme_Publication()
export_plot(p7, "Fig4.png", type = "png", width = 13, height = 8)
## Successional trajectorties
### Bacteria
ggplot2::ggplot(
scores.bact,
ggplot2::aes(NMDS1, NMDS2, group = forest, color = age)
) +
ggplot2::geom_path(alpha = 0.6) +
ggplot2::geom_point(size = 2) +
ggplot2::geom_point(
data = centroid.bact,
ggplot2::aes(NMDS1, NMDS2),
inherit.aes = FALSE,
shape = 4,
size = 5,
stroke = 2
) +
ggplot2::scale_color_viridis_c() +
theme_Publication()
## Computing distance to reference
### computing distance to reference as centroid
# extracting OGF rows ids
forest.idx <- data$categorie == "OGF"
data
forest.idx <- data$categorie == "OGF"
data.succ <- data
data.succ$dref_bact <- apply(
bray.mat.bact[, forest.idx, drop = FALSE],
1,
mean
)
data.succ$dref_bact_sd <- apply(
bray.mat.bact[, forest.idx, drop = FALSE],
1,
sd
)
data.succ$dref_amf <- apply(
bray.mat.amf[, forest.idx, drop = FALSE],
1,
mean
)
data.succ$dref_amf_sd <- apply(
bray.mat.amf[, forest.idx, drop = FALSE],
1,
sd
)
forest.idx <- data$categorie == "OGF"
data.succ <- data
data.succ$dref_bact <- apply(
bray.mat.bact[, forest.idx, drop = FALSE],
1,
mean
)
data.succ$dref_amf <- apply(
bray.mat.amf[, forest.idx, drop = FALSE],
1,
mean
)
data.succ
data.succ |>
dplyr::filter(!is.na(age)) |>
tidyr::pivot_longer(
cols = c(dref_bact, dref_amf),
names_to = "guild",
values_to = "dref"
)
data.succ |>
dplyr::filter(!is.na(age)) |>
dplyr::select(sample, forest, categorie, age, dref_amf, dref_bact) |>
tidyr::pivot_longer(
cols = c(dref_bact, dref_amf),
names_to = "guild",
values_to = "dref"
)
data.succ <- data.succ |>
dplyr::filter(!is.na(age)) |>
dplyr::select(sample, forest, categorie, age, dref_amf, dref_bact) |>
tidyr::pivot_longer(
cols = c(dref_bact, dref_amf),
names_to = "guild",
values_to = "dref"
) |>
dplyr::mutate(
guild = factor(
guild,
levels = c("dref_bact", "dref_amf"),
labels = c("Bacteria", "AMF")
)
)
data.succ
max(data.succ$dref)
min(data.succ$dref)
bayes.succ <- brm(
dref ~ s(age, by = guild) + guild + (1 | forest),
data = data.succ,
family = Beta(),
prior = c(
# fixed effects
prior(normal(0, 1), class = "b"),
# smooth term
prior(student_t(3, 0, 0.5), class = "sds"),
# random effect sd
prior(exponential(2), class = "sd"),
# precision param
prior(exponential(1), class = "phi")
),
chains = 4,
cores = 8,
iter = 4000,
control = list(adapt_delta = 0.99)
)
post.bayes.succ <- as_draws_df(bayes.succ)
# probability that AMF distance to forest decrease with age
P.amf.decline <- mean(post.bayes.succ$`bs_sage:guildAMF_1` < 0)
P.amf.decline
# probability that bacteria distance to forest decrease with age
P.bact.decline <- mean(post.bayes.succ$`bs_sage:guildBacteria_1` < 0)
P.bact.decline
# probability AMF age effect more negative than bacterial
P.amf.more.recovery <- mean(
post.bayes.succ$`bs_sage:guildAMF_1` <
post.bayes.succ$`bs_sage:guildBacteria_1`
)
P.amf.more.recovery
summary(bayes.succ)
post.bayes.succ <- as_draws_df(bayes.succ)
# probability that AMF distance to forest decrease with age
P.amf.decline <- mean(post.bayes.succ$`bs_sage:guildAMF_1` < 0)
P.amf.decline
# probability that bacteria distance to forest decrease with age
P.bact.decline <- mean(post.bayes.succ$`bs_sage:guildBacteria_1` < 0)
P.bact.decline
# probability AMF age effect more negative than bacterial
P.amf.more.recovery <- mean(
post.bayes.succ$`bs_sage:guildAMF_1` <
post.bayes.succ$`bs_sage:guildBacteria_1`
)
P.amf.more.recovery
# Fig 5. distance to reference vs time plot
newdat.succ <- data.succ |>
dplyr::distinct(guild) |>
tidyr::expand_grid(
age = seq(
min(data.traj$age, na.rm = TRUE),
max(data.traj$age, na.rm = TRUE),
length.out = 200
),
forest = NA
)
# Fig 5. distance to reference vs time plot
newdat.succ <- data.succ |>
dplyr::distinct(guild) |>
tidyr::expand_grid(
age = seq(
min(data.succ$age, na.rm = TRUE),
max(data.succ$age, na.rm = TRUE),
length.out = 200
),
forest = NA
)
newdat.succ
# Fig 5. distance to reference vs time plot
data.succ <- data.succ |>
dplyr::mutate(similarity = 1 - dref)
pred.dref <- bayes.succ |>
tidybayes::add_epred_draws(
newdata = newdat.succ,
re_formula = NA
) |>
dplyr::mutate(similarity = 1 - .epred)
data.succ
P.amf.decline
P.amf.decline
P.bact.decline
annot <- data.frame(
guild = c("AMF", "Bacteria"),
label = c(
"P(decline) = 0.80",
"P(decline) = 0.67"
),
x = max(data.succ$age) * 0.7,
y = c(0.15, 0.20)
)
p5 <- ggplot() +
geom_point(data = data.succ, aes(x = age, y = similarity, colour = guild), alpha = 0.5, size = 2) +
geom_text(
data = annot,
aes(x = x, y = y, label = label, colour = guild),
hjust = 0,
size = 4
) +
tidybayes::stat_lineribbon(data = pred.dref, aes(x = age, y = similarity, fill = guild), .width = 0.95, alpha = 0.25) +
stat_summary(data = pred.dref, aes(x = age, y = similarity, colour = guild), fun = mean, geom = "line", linewidth = 1.2) +
scale_colour_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
scale_fill_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
labs(
x = "Time since abandonment (years)",
y = "Distance to reference forest (Bray-Curtis)",
colour = "Guild",
fill = "Guild"
) +
theme_Publication()
newdat.succ <- data.succ |>
dplyr::distinct(guild) |>
tidyr::expand_grid(
age = seq(
min(data.succ$age, na.rm = TRUE),
max(data.succ$age, na.rm = TRUE),
length.out = 200
),
forest = NA
)
pred.dref <- bayes.succ |>
tidybayes::add_epred_draws(
newdata = newdat.succ,
re_formula = NA
) |>
dplyr::mutate(similarity = 1 - .epred)
annot <- data.frame(
guild = c("AMF", "Bacteria"),
label = c(
"P(decline) = 0.80",
"P(decline) = 0.67"
),
x = max(data.succ$age) * 0.7,
y = c(0.15, 0.20)
)
p5 <- ggplot() +
geom_point(data = data.succ, aes(x = age, y = similarity, colour = guild), alpha = 0.5, size = 2) +
geom_text(
data = annot,
aes(x = x, y = y, label = label, colour = guild),
hjust = 0,
size = 4
) +
tidybayes::stat_lineribbon(data = pred.dref, aes(x = age, y = similarity, fill = guild), .width = 0.95, alpha = 0.25) +
stat_summary(data = pred.dref, aes(x = age, y = similarity, colour = guild), fun = mean, geom = "line", linewidth = 1.2) +
scale_colour_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
scale_fill_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
labs(
x = "Time since abandonment (years)",
y = "Distance to reference forest (Bray-Curtis)",
colour = "Guild",
fill = "Guild"
) +
theme_Publication()
p5
annot <- data.frame(
guild = c("AMF", "Bacteria"),
label = c(
"P(decline) = 0.80",
"P(decline) = 0.67"
),
x = max(data.succ$age) * 0.7,
y = c(0.03, 0.05)
)
p5 <- ggplot() +
geom_point(data = data.succ, aes(x = age, y = similarity, colour = guild), alpha = 0.5, size = 2) +
geom_text(
data = annot,
aes(x = x, y = y, label = label, colour = guild),
hjust = 0,
size = 4
) +
tidybayes::stat_lineribbon(data = pred.dref, aes(x = age, y = similarity, fill = guild), .width = 0.95, alpha = 0.25) +
stat_summary(data = pred.dref, aes(x = age, y = similarity, colour = guild), fun = mean, geom = "line", linewidth = 1.2) +
scale_colour_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
scale_fill_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
labs(
x = "Time since abandonment (years)",
y = "Similarity to reference forest (1 − Bray–Curtis)",
colour = "Guild",
fill = "Guild"
) +
theme_Publication()
p5
p5 <- ggplot() +
geom_point(data = data.succ, aes(x = age, y = similarity, colour = guild), alpha = 0.5, size = 2) +
geom_text(
data = annot,
aes(x = x, y = y, label = label, colour = guild),
hjust = 0,
size = 4
) +
tidybayes::stat_lineribbon(data = pred.dref, aes(x = age, y = similarity, fill = guild), .width = 0.95, alpha = 0.25) +
stat_summary(data = pred.dref, aes(x = age, y = similarity, colour = guild), fun = mean, geom = "line", linewidth = 1.2) +
scale_colour_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
scale_fill_manual(
values = c("Bacteria" = "#0072B2", "AMF" = "#D55E00"),
) +
labs(
x = "Time since abandonment (years)",
y = "Similarity to reference forest (1 - Bray-Curtis)",
colour = "Guild",
fill = "Guild"
) +
theme_Publication()
export_plot(p5, "Fig5.png", type = "png", width = 13, height = 8)
